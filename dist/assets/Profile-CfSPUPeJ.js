import{_ as Ce,r as t,f as ce,o as Ue,m as Re,k as de,j as F,c as o,b as a,h as k,v as G,x as Q,ak as oa,t as m,F as ve,d as Se,w as ke,i as B,ag as Te,af as Ae,al as Ee,aj as Ie,u as W,l as Pe,am as Le,e as l,an as Ne,a as la,z as na,n as ia,g as ra,A as De,O as Fe,ao as _e,ap as ua,aq as ca,ar as da,H as va}from"./index-CIopMpJl.js";import{a as $e,d as x,r as we,s as be,g as Me,b as fa,u as ma}from"./firebase-BNgURHt8.js";const pa="/images/pencil-icon.png",Ye="/images/remove-icon.png",ha={class:"friends-list-container"},ya={class:"search-section"},ga={key:0,class:"error"},_a={class:"friends-list-wrapper"},wa={key:0,class:"loading"},ba={key:1,class:"no-friends"},ka={key:2,class:"friends-list"},Ca=["src","alt"],Ua={class:"friend-name"},Ra=["onClick"],$a={class:"search-modal"},xa={key:0,class:"search-result"},Pa=["src","alt"],La={class:"result-name"},Na={key:0,class:"already-friend"},Da={key:1,class:"self-message"},Fa=["disabled"],Ma={key:3,class:"success"},Sa={key:4,class:"error"},Ta={class:"remove-modal"},Aa={class:"modal-buttons"},Ea=["disabled"],ue="/images/placeholder-avatar.png",Ia={__name:"FriendsList",setup(xe){const v=t(null),y=t([]),p=t(!0),P=t(""),f=t(null),_=t(!1),L=t(""),T=t(!1),U=t(""),D=t(""),u=t(!1),c=t(null),w=t(!1),X=ce(()=>!f.value||!v.value?!1:y.value.some(i=>i.uid===f.value.uid)),C=ce(()=>!f.value||!v.value?!1:f.value.uid===v.value.uid);Ue(()=>{Re($e,async i=>{i?(v.value=i,await g()):(v.value=null,y.value=[],p.value=!1)})});async function g(){if(v.value){p.value=!0;try{const i=await de(F(x,"users",v.value.uid));if(!i.exists()){y.value=[],p.value=!1;return}const d=i.data().friendsList||[];if(d.length===0){y.value=[],p.value=!1;return}const b=[];for(const R of d)try{const M=await de(F(x,"users",R));M.exists()&&b.push({uid:R,displayName:M.data().displayName||"Unknown",photoURL:M.data().photoURL||ue})}catch(M){console.error(`Error fetching friend ${R}:`,M)}y.value=b}catch(i){console.error("Error loading friends:",i)}finally{p.value=!1}}}async function H(){L.value="",f.value=null;const i=P.value.trim();if(!i){L.value="Please enter a display name to search.";return}if(!v.value){L.value="You must be logged in to search.";return}try{const d=Te(Ae(x,"users"),Ee("displayName","==",i)),b=await Ie(d);if(b.empty){L.value="No user found with that display name.";return}const R=b.docs[0];f.value={uid:R.id,displayName:R.data().displayName,photoURL:R.data().photoURL||ue},_.value=!0}catch(d){console.error("Error searching user:",d),L.value="An error occurred while searching."}}function A(){_.value=!1,f.value=null,U.value="",D.value=""}async function N(){if(!(!v.value||!f.value)){T.value=!0,D.value="",U.value="";try{const i=F(x,"users",v.value.uid),d=F(x,"users",f.value.uid);await W(i,{friendsList:Pe(f.value.uid)}),await W(d,{friendsList:Pe(v.value.uid)}),U.value="Friend added successfully!",await g(),setTimeout(()=>{A(),P.value=""},1500)}catch(i){console.error("Error adding friend:",i),D.value=i.message||"Failed to add friend."}finally{T.value=!1}}}function oe(i){c.value=i,u.value=!0}function O(){u.value=!1,c.value=null}async function ee(){if(!(!v.value||!c.value)){w.value=!0;try{const i=F(x,"users",v.value.uid),d=F(x,"users",c.value.uid);await W(i,{friendsList:Le(c.value.uid)}),await W(d,{friendsList:Le(v.value.uid)}),await g(),O()}catch(i){console.error("Error removing friend:",i),alert("Failed to remove friend: "+(i.message||"Unknown error"))}finally{w.value=!1}}}return(i,d)=>(l(),o("div",ha,[d[5]||(d[5]=a("h2",{class:"section-title"},"Friends",-1)),a("div",ya,[G(a("input",{"onUpdate:modelValue":d[0]||(d[0]=b=>P.value=b),type:"text",placeholder:"Search users by username...",class:"search-input",onKeyup:oa(H,["enter"])},null,544),[[Q,P.value]]),a("button",{onClick:H,class:"btn-search bg-success"},"Search")]),L.value?(l(),o("p",ga,m(L.value),1)):k("",!0),a("div",_a,[p.value?(l(),o("div",wa,"Loading friends...")):y.value.length===0?(l(),o("div",ba," No friends yet. Search for users to add them! ")):(l(),o("div",ka,[(l(!0),o(ve,null,Se(y.value,b=>(l(),o("div",{key:b.uid,class:"friend-item"},[a("img",{src:b.photoURL||ue,alt:b.displayName,class:"friend-avatar"},null,8,Ca),a("span",Ua,m(b.displayName),1),a("button",{onClick:R=>oe(b),class:"btn-remove-friend",title:"Remove friend"},[...d[1]||(d[1]=[a("img",{src:Ye,alt:"Remove",class:"remove-icon"},null,-1)])],8,Ra)]))),128))]))]),_.value?(l(),o("div",{key:1,class:"modal-overlay",onClick:ke(A,["self"])},[a("div",$a,[a("button",{class:"close-btn",onClick:A},"×"),f.value?(l(),o("div",xa,[a("img",{src:f.value.photoURL||ue,alt:f.value.displayName,class:"result-avatar"},null,8,Pa),a("h3",La,m(f.value.displayName),1),X.value?(l(),o("div",Na," Already friends! ")):C.value?(l(),o("div",Da," This is you! ")):(l(),o("button",{key:2,onClick:N,class:"btn-add-friend",disabled:T.value},m(T.value?"Adding...":"Add Friend"),9,Fa)),U.value?(l(),o("p",Ma,m(U.value),1)):k("",!0),D.value?(l(),o("p",Sa,m(D.value),1)):k("",!0)])):k("",!0)])])):k("",!0),u.value?(l(),o("div",{key:2,class:"modal-overlay",onClick:ke(O,["self"])},[a("div",Ta,[d[4]||(d[4]=a("h3",null,"Remove Friend",-1)),a("p",null,[d[2]||(d[2]=B("Are you sure you want to remove ",-1)),a("strong",null,m(c.value?.displayName),1),d[3]||(d[3]=B(" from your friends list?",-1))]),a("div",Aa,[a("button",{onClick:ee,class:"btn-confirm-remove",disabled:w.value},m(w.value?"Removing...":"Yes, Remove"),9,Ea),a("button",{onClick:O,class:"btn-cancel-remove"}," Cancel ")])])])):k("",!0)]))}},Ya=Ce(Ia,[["__scopeId","data-v-03261d31"]]),Ha={class:"favourites-list-container"},Va={class:"favourites-list-wrapper"},Wa={key:0,class:"loading"},Xa={key:1,class:"no-favourites"},qa={key:2,class:"favourites-list"},za=["src","alt"],Za={class:"favourite-info"},ja={class:"favourite-title"},Ba={class:"favourite-date"},Oa=["onClick"],Ja={class:"remove-modal"},Ka={class:"modal-buttons"},Ga=["disabled"],Qa={__name:"FavouritesList",setup(xe){const v=t(null),y=t([]),p=t(!0),P=t(!1),f=t(null),_=t(!1);Ue(()=>{Re($e,async u=>{u?(v.value=u,await L()):(v.value=null,y.value=[],p.value=!1)})});async function L(){if(v.value){p.value=!0;try{const u=await de(F(x,"users",v.value.uid));if(!u.exists()){y.value=[],p.value=!1;return}const c=u.data().favouritesList||[];y.value=c}catch(u){console.error("Error loading favourites:",u)}finally{p.value=!1}}}function T(u){f.value=u,P.value=!0}function U(){P.value=!1,f.value=null}async function D(){if(!(!v.value||!f.value)){_.value=!0;try{const u=F(x,"users",v.value.uid),c=y.value.filter(w=>w.id!==f.value.id);await W(u,{favouritesList:c}),y.value=c,U()}catch(u){console.error("Error removing favourite:",u),alert("Failed to remove favourite: "+(u.message||"Unknown error"))}finally{_.value=!1}}}return(u,c)=>(l(),o("div",Ha,[c[4]||(c[4]=a("h2",{class:"section-title"},"Saved Activities",-1)),a("div",Va,[p.value?(l(),o("div",Wa,"Loading...")):y.value.length===0?(l(),o("div",Xa," No saved activities yet. Start exploring and add some! ")):(l(),o("div",qa,[(l(!0),o(ve,null,Se(y.value,w=>(l(),o("div",{key:w.id,class:"favourite-item"},[a("img",{src:w.image,alt:w.title,class:"favourite-image"},null,8,za),a("div",Za,[a("span",ja,m(w.title),1),a("span",Ba,m(w.date),1)]),a("button",{onClick:X=>T(w),class:"btn-remove-favourite",title:"Remove from favourites"},[...c[0]||(c[0]=[a("img",{src:Ye,alt:"Remove",class:"remove-icon"},null,-1)])],8,Oa)]))),128))]))]),P.value?(l(),o("div",{key:0,class:"modal-overlay",onClick:ke(U,["self"])},[a("div",Ja,[c[3]||(c[3]=a("h3",null,"Remove Favourite",-1)),a("p",null,[c[1]||(c[1]=B("Are you sure you want to remove ",-1)),a("strong",null,m(f.value?.title),1),c[2]||(c[2]=B(" from your favourites?",-1))]),a("div",Ka,[a("button",{onClick:D,class:"btn-confirm-remove",disabled:_.value},m(_.value?"Removing...":"Yes, Remove"),9,Ga),a("button",{onClick:U,class:"btn-cancel-remove"}," Cancel ")])])])):k("",!0)]))}},es=Ce(Qa,[["__scopeId","data-v-cce75430"]]),as={class:"profile-page"},ss={key:0,class:"status"},ts={key:1,class:"profile-card"},os={class:"left"},ls={class:"avatar-container"},ns=["src"],is={class:"avatar-buttons"},rs=["disabled"],us={key:0},cs={class:"right"},ds={class:"info-section"},vs={class:"info-row"},fs={class:"field-content"},ms={class:"username"},ps={class:"info-row"},hs={class:"field-content"},ys={class:"info-row"},gs={class:"field-content"},_s={key:0,class:"bio"},ws={key:1,class:"note"},bs={key:2,class:"modal-overlay"},ks={class:"modal"},Cs={key:0,class:"error"},Us={key:1,class:"success"},Rs={class:"modal-buttons"},$s=["disabled"],xs={key:3,class:"crop-modal-overlay"},Ps={class:"crop-modal"},Ls=["src"],Ns={class:"zoom-control"},Ds=["min","max"],Fs={class:"lists-container"},K="/images/placeholder-avatar.png",Y=150,Ms={__name:"Profile",setup(xe){const v=t(!0),y=t(null);t("");const p=t(""),P=t(""),f=t(""),_=t(""),L=t(!1),T=t(""),U=t(!1),D=t(""),u=t(!1),c=t(!1),w=t(null),X=t(""),C=t(1),g=t({x:0,y:0}),H=t(!1),A=t({x:0,y:0}),N=t(null),oe=t(null),O=t(null),ee=t(!1),i=t(""),d=t("success");let b=null;const R=t(0),M=t(0),fe=t(.1),He=t(3);function E(s,e="success"){b&&clearTimeout(b),i.value=s,d.value=e,ee.value=!0,b=setTimeout(()=>{ee.value=!1},3e3)}const me=ce(()=>R.value*C.value),pe=ce(()=>M.value*C.value);function Ve(){if(!N.value||!R.value||!M.value)return .1;N.value.offsetWidth,N.value.offsetHeight;const s=2*Y/R.value,e=2*Y/M.value;return Math.max(s,e)}function le(s){if(!N.value)return s;const e=N.value.offsetWidth,n=N.value.offsetHeight,r=e/2,$=n/2,S=me.value,ae=pe.value;let Z=s.x,j=s.y;const ie=r-Y;Z>ie&&(Z=ie);const re=r+Y-S;Z<re&&(Z=re);const se=$-Y;j>se&&(j=se);const te=$+Y-ae;return j<te&&(j=te),{x:Z,y:j}}Ne(C,()=>{g.value=le(g.value)}),Ne(w,s=>{if(s){const e=new FileReader;e.onload=n=>{const r=new Image;r.onload=()=>{R.value=r.width,M.value=r.height,X.value=n.target.result,va(()=>{if(fe.value=Ve(),C.value=fe.value,N.value){const $=N.value.offsetWidth,S=N.value.offsetHeight,ae={x:($-me.value)/2,y:(S-pe.value)/2};g.value=le(ae)}})},r.src=n.target.result},e.readAsDataURL(s)}});function We(s){H.value=!0,A.value={x:s.clientX-g.value.x,y:s.clientY-g.value.y}}function Xe(s){if(H.value){const e={x:s.clientX-A.value.x,y:s.clientY-A.value.y};g.value=le(e)}}function he(){H.value=!1}function qe(s){const e=s.touches[0];H.value=!0,A.value={x:e.clientX-g.value.x,y:e.clientY-g.value.y}}function ze(s){if(H.value&&s.touches[0]){const e=s.touches[0],n={x:e.clientX-A.value.x,y:e.clientY-A.value.y};g.value=le(n)}}async function Ze(){const s=O.value,e=N.value,n=oe.value;if(!s||!e||!n)return;const r=300;s.width=r,s.height=r;const $=s.getContext("2d"),S=e.offsetWidth/2,ae=e.offsetHeight/2,Z=(S-g.value.x)/C.value,j=(ae-g.value.y)/C.value,ie=Z-Y/C.value,re=j-Y/C.value,se=2*Y/C.value;$.beginPath(),$.arc(r/2,r/2,r/2,0,Math.PI*2),$.closePath(),$.clip(),$.drawImage(n,ie,re,se,se,0,0,r,r),s.toBlob(te=>{te&&Qe(te)},"image/jpeg",.95)}let h=null,ye=null;Ue(()=>{ye=Re($e,async s=>{v.value=!0,y.value=null,p.value="",P.value="",f.value="",L.value=!1,_.value=K,h=s;try{if(s){const e=F(x,"users",s.uid),n=await de(e);if(n.exists()){L.value=!0;const r=n.data();if(p.value=Fe(r.displayName||s.displayName||""),P.value=r.email||s.email||"",f.value=r.bio||"",r.createdAt){const S=r.createdAt.toDate();T.value=S.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}const $=r.photoURL||s.photoURL;try{const S=we(be,`profilePictures/${s.uid}`);_.value=await Me(S)}catch{_.value=K}}else{if(p.value=s.displayName||"",P.value=s.email||"",s.metadata.creationTime){const r=new Date(s.metadata.creationTime);T.value=r.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}_.value=s.photoURL||K}}}catch(e){console.error("Failed to fetch profile:",e),y.value=e.message||String(e)}finally{v.value=!1}})}),la(()=>{typeof ye=="function"&&ye()});function je(){U.value=!0,D.value=p.value}function Be(){U.value=!1}async function Oe(s,e,n){const r=Te(Ae(x,"users"),Ee(s,"==",e)),$=await Ie(r);return $.empty||$.docs.every(S=>S.id===n)}async function Je(){if(!h){E("User not logged in.","error");return}const s=Fe(D.value.trim());if(!s){E("Username cannot be empty.","error");return}try{if(!await Oe("displayName",s,h.uid)){E("This username is already taken.","error");return}s!==h.displayName&&await _e(h,{displayName:s});const n=F(x,"users",h.uid);await W(n,{displayName:s}),p.value=s,U.value=!1,E("Username updated successfully!"),setTimeout(()=>{window.location.reload()},1e3)}catch(e){console.error(e),E(e.message||String(e),"error")}}async function Ke(s){const e=s.target.files[0];!e||!h||(w.value=e,c.value=!0,s.target.value="")}async function Ge(){if(!(!h||!confirm("Are you sure?"))){u.value="deleting";try{const e=we(be,`profilePictures/${h.uid}`);await fa(e),await _e(h,{photoURL:null});const n=F(x,"users",h.uid);await W(n,{photoURL:K}),_.value=K,E("Profile picture deleted successfully!")}catch(e){console.error("Error deleting profile picture:",e),E(e.code?`${e.code}: ${e.message}`:e.message||String(e),"error")}finally{u.value=!1}}}async function Qe(s){if(h){u.value="uploading",c.value=!1;try{const e=we(be,`profilePictures/${h.uid}`);await ma(e,s);const n=await Me(e);await _e(h,{photoURL:n});const r=F(x,"users",h.uid);await W(r,{photoURL:n}),_.value=n,E("Profile picture updated successfully!")}catch(e){console.error(e),E(e.code?`${e.code}: ${e.message}`:e.message||String(e),"error")}finally{u.value=!1}}}function ea(){c.value=!1,w.value=null,X.value="",C.value=1,g.value={x:0,y:0},R.value=0,M.value=0}const ge=t(!1),q=t(""),V=t(""),z=t(""),I=t(""),J=t(""),ne=t(!1);function aa(){ge.value=!0,q.value="",V.value="",z.value="",I.value="",J.value=""}function sa(){ge.value=!1,q.value="",V.value="",z.value="",I.value="",J.value=""}async function ta(){if(I.value="",J.value="",!h){I.value="User not logged in.";return}if(!q.value||!V.value||!z.value){I.value="All fields are required.";return}if(V.value!==z.value){I.value="New passwords do not match.";return}ne.value=!0;try{const s=ua.credential(h.email,q.value);await ca(h,s),await da(h,V.value),J.value="Password updated successfully!",q.value="",V.value="",z.value=""}catch(s){console.error(s),I.value=s.code?`${s.code}: ${s.message}`:s.message||String(s)}finally{ne.value=!1}}return(s,e)=>(l(),o("div",as,[e[15]||(e[15]=a("h1",{class:"title"},"Your Profile",-1)),v.value?(l(),o("div",ss,"Loading profile…")):(l(),o("div",ts,[a("div",os,[a("div",ls,[a("img",{class:"avatar",src:_.value,alt:"Profile picture"},null,8,ns),a("div",is,[e[5]||(e[5]=a("label",{for:"profile-pic-upload",class:"btn-upload-pic bg-success"}," Upload Picture ",-1)),a("input",{id:"profile-pic-upload",type:"file",accept:"image/*",onChange:Ke,class:"upload-input"},null,32),_.value!==K?(l(),o("button",{key:0,onClick:Ge,class:"btn-delete-pic",disabled:u.value}," Delete Picture ",8,rs)):k("",!0)]),u.value?(l(),o("p",us,m(u.value==="deleting"?"Deleting...":"Uploading..."),1)):k("",!0)])]),a("div",cs,[a("div",ds,[a("div",vs,[e[6]||(e[6]=a("strong",null,"Username:",-1)),a("div",fs,[U.value?(l(),o(ve,{key:0},[G(a("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>D.value=n),type:"text",class:"input"},null,512),[[Q,D.value]]),a("button",{onClick:Je,class:"btn-save-field"},"Save"),a("button",{onClick:Be,class:"btn-cancel-field"},"Cancel")],64)):(l(),o(ve,{key:1},[a("span",ms,m(p.value||"No username set"),1),a("img",{src:pa,alt:"Edit",class:"edit-icon",onClick:je})],64))])]),a("div",ps,[e[7]||(e[7]=a("strong",null,"Email:",-1)),a("div",hs,[a("span",null,m(P.value||"No email available"),1)])]),a("div",ys,[e[8]||(e[8]=a("strong",null,"Date Joined:",-1)),a("div",gs,[a("span",null,m(T.value||"N/A"),1)])]),f.value?(l(),o("p",_s,m(f.value),1)):k("",!0),L.value?k("",!0):(l(),o("p",ws," (Profile document not found – showing auth data where available.) "))]),a("div",{class:"change-password-section"},[a("button",{class:"btn-change-password bg-success",onClick:aa},"Change Password")])])])),ge.value?(l(),o("div",bs,[a("div",ks,[e[12]||(e[12]=a("h2",null,"Change Password",-1)),a("label",null,[e[9]||(e[9]=B(" Old Password ",-1)),G(a("input",{type:"password","onUpdate:modelValue":e[1]||(e[1]=n=>q.value=n)},null,512),[[Q,q.value]])]),a("label",null,[e[10]||(e[10]=B(" New Password ",-1)),G(a("input",{type:"password","onUpdate:modelValue":e[2]||(e[2]=n=>V.value=n)},null,512),[[Q,V.value]])]),a("label",null,[e[11]||(e[11]=B(" Confirm New Password ",-1)),G(a("input",{type:"password","onUpdate:modelValue":e[3]||(e[3]=n=>z.value=n)},null,512),[[Q,z.value]])]),I.value?(l(),o("p",Cs,m(I.value),1)):k("",!0),J.value?(l(),o("p",Us,m(J.value),1)):k("",!0),a("div",Rs,[a("button",{onClick:ta,disabled:ne.value},m(ne.value?"Updating...":"Update Password"),9,$s),a("button",{onClick:sa},"Cancel")])])])):k("",!0),c.value?(l(),o("div",xs,[a("div",Ps,[e[14]||(e[14]=a("h2",null,"Adjust Your Profile Picture",-1)),a("div",{ref_key:"cropContainer",ref:N,class:"crop-container",onMousedown:We,onMousemove:Xe,onMouseup:he,onMouseleave:he,onTouchstart:qe,onTouchmove:ze,onTouchend:he},[X.value?(l(),o("img",{key:0,ref_key:"cropImage",ref:oe,src:X.value,alt:"Preview",class:"crop-image",style:ia({left:g.value.x+"px",top:g.value.y+"px",width:me.value+"px",height:pe.value+"px"}),draggable:"false"},null,12,Ls)):k("",!0),e[13]||(e[13]=na('<svg class="crop-overlay" data-v-4fb2c76c><defs data-v-4fb2c76c><mask id="circleMask" data-v-4fb2c76c><rect width="100%" height="100%" fill="white" data-v-4fb2c76c></rect><circle cx="50%" cy="50%" r="150" fill="black" data-v-4fb2c76c></circle></mask></defs><rect width="100%" height="100%" fill="rgba(0, 0, 0, 0.5)" mask="url(#circleMask)" data-v-4fb2c76c></rect><circle cx="50%" cy="50%" r="150" fill="none" stroke="white" stroke-width="3" stroke-dasharray="10,5" data-v-4fb2c76c></circle></svg>',1))],544),a("div",Ns,[a("label",null,"Zoom: "+m(C.value.toFixed(2))+"x",1),G(a("input",{type:"range",min:fe.value,max:He.value,step:"0.01","onUpdate:modelValue":e[4]||(e[4]=n=>C.value=n),class:"zoom-slider"},null,8,Ds),[[Q,C.value,void 0,{number:!0}]])]),a("div",{class:"crop-modal-buttons"},[a("button",{onClick:ea,class:"btn-cancel"},"Cancel"),a("button",{onClick:Ze,class:"btn-confirm"},"Crop & Upload")]),a("canvas",{ref_key:"cropCanvas",ref:O,style:{display:"none"}},null,512)])])):k("",!0),ee.value?(l(),o("div",{key:4,class:ra(["toast",d.value])},m(i.value),3)):k("",!0),a("div",Fs,[De(Ya),De(es)])]))}},As=Ce(Ms,[["__scopeId","data-v-4fb2c76c"]]);export{As as default};
